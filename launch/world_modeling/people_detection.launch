<?xml version="1.0"?>
<launch>

    <!-- Get the machine file -->
    <arg name="machine" default="localhost"/>
    <arg name="camera_ns" />

    <arg name="faces_db" default="" />

    <arg name="face_recognition_config" default="world_modeling/face_recognition.yaml"/>

    <arg name="face_properties_model" default="~/data/keras_models/age_gender/weights.28-3.73.hdf5"/>

    <include file="$(env ROBOT_BRINGUP_PATH)/machines/$(arg machine).machine" />

    <!-- People recognition -->
    <node name="people_detector" pkg="people_detector" type="people_detector" output="log" machine="$(arg machine)" respawn="true">
        <param name="link_threshold" value="0.8" />
        <param name="wave_threshold" value="0.3" />
        <param name="probability_threshold" value="0.6" />
        <param name="arm_norm_threshold" value="0.9" />
        <param name="heuristic" value="shoulder" />

        <!-- TUe -->
        <remap from="camera/rgb/image" to="$(arg camera_ns)/rgb/image" />\
        <remap from="camera/depth/image" to="$(arg camera_ns)/depth/image" />
        <remap from="camera/depth/camera_info" to="$(arg camera_ns)/depth/camera_info" />

        <!-- freenect -->
        <!-- <remap from="camera/rgb/image" to="$(arg name)/rgb/image_rect_color" />\ -->
        <!-- <remap from="camera/depth/image" to="$(arg name)/depth_registered/sw_registered/image_rect" /> -->
        <!-- <remap from="camera/depth/camera_info" to="$(arg name)/depth_registered/sw_registered/camera_info" /> -->
    </node>

    <!-- Face recognition -->
	<group ns="face_recognition">
		<node name="face_recognition" pkg="image_recognition_openface" type="face_recognition_node" output="log" machine="$(arg machine)">
			<rosparam command="load" file="$(env ROBOT_BRINGUP_PATH)/parameters/$(arg face_recognition_config)" />
			<param name="topic_save_images" value="false" />
			<param name="service_save_images" value="$(arg robot_real)" />
			<param name="save_images_folder" value="~/MEGA/data/$(arg robot_env)/training_data" />
			<param name="db" value="$(arg faces_db)" />
		</node>

		<node pkg="image_recognition_keras" type="face_properties_node" name="keras_face_properties">
			<param name="weights_file_path" value="$(arg face_properties_model)" />
			<param name="save_images" value="$(arg robot_real)" />
			<param name="save_images_folder" value="~/MEGA/data/$(arg robot_env)/training_data" />
		</node>
	</group>

</launch>
